## 1. 배포 계획

프론트엔드 배포는 먼저 프로젝트를 빌드한 다음에 cloud storage(aws의 s3 같은 서비스)에 정적 파일을 올려서 호스팅 하는 방법으로 배포를 하려고 생각했습니다.

1. 프로젝트 빌드
2. 빌드된 static 파일을 cloud storage에 업로드

GCP에서 부하분산기(로드밸런서)를 생성하여 부하분산기의 IP를 이용하여 정적 호스팅을 지원하는 방법을 제공해주었고 해당 방법으로 배포를 시도해보았습니다.

1. 부하분산기 생성 및 SSL 생성
2. 부하분산기 IP와 도메인 연동
3. 접속

위와 같은 방법을 통해 프론트엔드를 간단하게 배포할 수 있을 줄 알았으나…

## 2. 라우팅 이슈

스토리지를 이용해서 정적 배포를 완료하고 나서 Root URL (domain/)을 통해서 접근은 정상적으로 되었던 반면

하위 리소스 경로(domain/accounts/login/ 등)을 통해 접속을 하는 경우 아래와 같이 접근 권한 문제가 발생했습니다.

<img src="https://github.com/user-attachments/assets/bf75ee84-5bca-4123-90f7-b088574c23a6" width="600">

크롬 개발자 도구의 네트워크 탭이나 콘솔창을 통해 원인을 찾아보려고 했지만 쉽게 찾을 수 없어 배포 방법을 바꿔보기로 했습니다.

## 3. Nginx를 사용한 정적 파일 배포

두 번째로 시도한 방법은 가상 머신에 프로젝트 정적파일을 올리고 nginx를 사용하여 정적 파일로 포워딩을 시켜주는 방법을 시도해보았습니다.

기존 back-end를 배포한 인스턴스를 그대로 사용하였고 마찬가지로 nginx를 사용해 도메인 레코드별로 포트포워딩하는 방법을 생각해보았습니다.

- 프론트 - domain.com
- 백엔드 - api.domain.com
1. 가상 머신에 프론트엔드 프로젝트를 clone 합니다
2. .env와 같은 설정 파일을 직접 작성한 뒤 프로젝트를 빌드합니다.
3. 도메인 별로 각 서비스로 포워딩 될 수 있도록 nginx 설정 파일을 수정합니다.

배포를 완료한 뒤 같은 이슈가 발생하는지 확인해 보았습니다.

## 4. 프로젝트 빌드 이슈 (Web Pack) 및 해결

배포 방법을 바꿔보았지만 여전히 하위 경로로 직접 접속하는 경우 에러가 발생했습니다.

첫 번째 시도와 달라진 점은 개발자 도구 네트워크 탭에서 오류를 확인할 수 있게 되었습니다.

네트워크 탭을 살펴보니 루트 경로로 접속하는 경우 정상적으로 Js 파일을 불러오는 반면 하위 리소스 경로로 접속하는 경우 js 파일을 제대로 불러오지 못하고 있었습니다.

다음으로 빌드 설정 파일을 확인해보니 다음과 같이 publicPath 설정이 상대 경로로 설정되어있었고 이를 절대 경로로 수정하여 재빌드 후 테스트를 해보았습니다

```jsx
// publicPath - 상대 경로
output: {
	filename: '[name].[contenthash].js',
	path: path.resolve(__dirname, '../dist'),
	publicPath: './',
	clean: true
},

// publicPath 수정 - 절대 경로
output: {
	filename: '[name].[contenthash].js',
	path: path.resolve(__dirname, '../dist'),
	publicPath: '/',
	clean: true
},
```

테스트 결과 정상적으로 하위 리소스 URL로 접근이 되는 것을 확인하였습니다.

이 후 storage 서비스를 사용하여 테스트 했을 때도 정상적으로 동작 하였고 프론트엔드 배포까지 마무리 되었습니다.
